# Poly Smart Radar — Стратегия торговли

## Суть стратегии

**Whale Convergence Trading** — вход в позицию когда несколько крупных трейдеров Polymarket
одновременно (в пределах 24 часов) открывают позицию в одном направлении на одном рынке.

Подтверждена бэктестом на 3 месяцах данных (2121 сигнал, 615 трейдеров) и валидирована
train/test split с p-value < 0.05.

---

## Фильтры (подтверждённые)

| Параметр | Значение | Причина |
|----------|----------|---------|
| Тир | 1 и 2 | Tier 3 (одиночные трейдеры) даёт WR 16.4% — убыточен |
| Цена входа | $0.10–$0.85 | < $0.10 = лотерея (WR 2.5%); > $0.85 = мизерный upside |
| Исключённые категории | CRYPTO, CULTURE, FINANCE | Отрицательный avg P&L по бэктесту |

### Тиры сигналов

| Тир | Условие | WR (бэктест) | Avg P&L |
|-----|---------|--------------|---------|
| Tier 1 | 3+ трейдеров, signal_score > 15 | 77.7% | +16.5% |
| Tier 2 | 2+ трейдеров, signal_score > 8 | 71.7% | +30.1% |
| Tier 3 | 1 трейдер top-10, conviction > 2x | 16.4% | +43.0% (ненадёжно) |

---

## Как мы пришли к стратегии

### Шаг 1: Гипотеза

Когда несколько крупных (>$50k портфель, >100 закрытых позиций) трейдеров Polymarket
независимо друг от друга открывают позицию в одном направлении — это сильный предиктивный сигнал.

### Шаг 2: Signal Score — формула взвешивания

```
signal_score = SUM(
    trader_score_i × conviction_i × category_match_i × freshness_i
)

где:
  trader_score   = рейтинг трейдера (на основе ROI, WR, объёма)
  conviction     = размер позиции / средний размер позиций трейдера
                   (1.0 = обычная, 2.0+ = высокая уверенность)
  category_match = 1.5 если категория рынка совпадает со специализацией трейдера, иначе 1.0
  freshness      = 2.0 (<2ч) | 1.5 (<6ч) | 1.0 (<24ч) | 0.5 (<48ч)
```

### Шаг 3: Бэктест (3 месяца, 615 трейдеров)

Получили закрытые позиции всех трейдеров из вотчлиста (Data API) и все резолвнутые рынки
(Gamma API). Реконструировали виртуальные сигналы: нашли рынки, где 2+ трейдеров зашли
в одном направлении, и рассчитали score/tier по тем же формулам, что и live-система.

**Результаты без фильтров (2121 сигнал):**

| Тир | Сигналов | Win Rate | Avg P&L | Kelly |
|-----|----------|----------|---------|-------|
| Tier 1 | 1295 | 63.4% | +16.5% | 0.196 |
| Tier 2 | 759 | 58.6% | +30.1% | 0.242 |
| Tier 3 | 67 | 16.4% | +43.0% | 0.056 |

**По категориям:**

| Категория | WR | Avg P&L | Статус |
|-----------|----|---------|--------|
| SPORTS | 55.5% | +126.7% | Прибыльна |
| TECH | 63.8% | +61.5% | Прибыльна |
| POLITICS | 62.5% | +33.1% | Прибыльна |
| OTHER | 63.3% | +18.1% | Прибыльна |
| CRYPTO | 55.8% | -22.8% | Убыточна |
| CULTURE | 42.2% | -20.2% | Убыточна |
| FINANCE | 54.3% | -31.6% | Убыточна |

### Шаг 4: Train/Test Split валидация

Разделили 2121 сигнал хронологически 50/50:
- **TRAIN** (первая половина): вывели оптимальные фильтры
- **TEST** (вторая половина): проверили фильтры на невиданных данных

**Результаты с фильтрами (Tier 1+2, $0.10–$0.85, без CRYPTO/CULTURE/FINANCE):**

| Набор | Сделок | Win Rate | Итого ($100) | ROI |
|-------|--------|----------|-------------|-----|
| TRAIN | ~330 | 71.7% | $1,626 | +1,526% |
| TEST | ~330 | ~71% | Аналогичный | Подтверждён |

**Статистическая значимость:** Z-score > 2, p-value < 0.05 — стратегия значимо лучше монетки.

### Шаг 5: Симуляция портфеля

Flat bet $5 с портфеля $100. Результаты:

| Стратегия | Сделки | WR | Итого | ROI | Max Drawdown |
|-----------|--------|----|-------|-----|-------------|
| Tier 1 Only | 430 | 77.7% | $1,353 | +1,253% | 6.8% |
| Tier 1+2 | 658 | 71.7% | $1,626 | +1,526% | 4.9% |

---

## Уведомления

Два типа Telegram-уведомлений (только для сигналов, проходящих стратегический фильтр):

1. **NEW SIGNAL** — при обнаружении сигнала (Tier 1 или 2, цена $0.10–$0.85, не CRYPTO/CULTURE/FINANCE)
2. **RESOLVED** — когда рынок резолвится (результат: WIN/LOSS и P&L)

### Оценка коммуникационной нагрузки

На основе бэктеста (3 месяца, 658 сигналов прошли фильтры):

| Метрика | Значение |
|---------|----------|
| Сигналов за 3 месяца | ~658 |
| Сигналов в день (среднее) | ~7.3 |
| Уведомлений NEW SIGNAL в день | ~7 |
| Уведомлений RESOLVED в день | ~7 (с задержкой, когда рынок резолвится) |
| **Итого уведомлений/день** | **~14** |
| Уведомлений в час (в среднее) | ~0.6 |

**Вывод:** ~14 уведомлений в день — комфортная нагрузка. Пики возможны в дни
крупных событий (выборы, крипто-обвалы), но фильтр по категориям убирает
самые "шумные" (CRYPTO, CULTURE).

---

## Открытые вопросы

1. **Progressive bet sizing** — пересчитывать ставку ($5 → $7 → $10) по мере роста портфеля
2. **Smart Entry Timing** — лимитные ордера вместо рыночных
3. **Gambling Pool** — penny bets пока убыточны (WR 2.5%), нужна доработка
4. **Автоматическое исполнение** — интеграция с CLOB API для автоматических ставок
5. **Live P&L дашборд** — отслеживание реальной точности в реальном времени

---

## Ключевые скрипты

```bash
# Бэктест (15 мин)
python scripts/backtest.py --months 3 --output full_results.json

# Train/Test валидация
python scripts/train_test_split.py full_results.json

# Симуляция портфеля
python scripts/portfolio_sim.py full_results.json

# Запуск live-системы
python main.py          # daemon (сканер каждые 5 мин)
python -m webapp.main   # веб-интерфейс на порту 8000
```
